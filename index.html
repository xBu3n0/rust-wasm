<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div id="text"></div>

    <div id="file-input"></div>

    <script type="module">
        import init, {Perceptron, read_file} from './pkg/rust_wasm.js'

        await init()
        
        let data = [[2.7810836,2.550537003,0],
                [1.465489372,2.362125076,0],
                [3.396561688,4.400293529,0],
                [1.38807019,1.850220317,0],
                [3.06407232,3.005305973,0],
                [7.627531214,2.759262235,1],
                [5.332441248,2.088626775,1],
                [6.922596716,1.77106367,1],
                [8.675418651,-0.242068655,1]]
        
        const rows = data.length
        console.log(rows)
        const cols = data[0].length
        console.log(cols)

        data = data.flat()
        const answ_index = 2

        // new(params: &[usize], data: &[f32], answ_index: usize, rows: usize, cols: usize)
        const x = new Perceptron([1], data, answ_index, rows, cols, 0.01)
        x.set_step_size(0.00001)

        const n_iter = 10000000

        console.log(x.get_perceptron())
        const init_time = Date.now() 
        const w = x.train(n_iter, false)
        const end_time = Date.now()
        const acc = x.get_accuracy()

        const [info_train, n] = w

        console.log(w)
        console.log(info_train)
        console.log('Demorou ', (end_time-init_time), 'ms para terminar a execução de ', n, 'x, gastando ', ((end_time-init_time))/n, 'ms por iteração')
        console.log(x.get_perceptron())

        // Leitura de arquivo
        function readTextFile(file) {
            var rawFile = new XMLHttpRequest();
            rawFile.open("GET", file, false);

            var fileContent = "";

            rawFile.onreadystatechange = function () {
                if (rawFile.readyState === 4) {
                    if (rawFile.status === 200 || rawFile.status == 0) {
                        fileContent = rawFile.responseText;
                    }
                }
            }

            rawFile.send(null);

            return fileContent;
        }

        const t = readTextFile('teste.txt')

        console.log(t)
    </script>
</body>
</html>